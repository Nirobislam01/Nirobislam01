<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCS Physics Editor | Bus Physics Customizer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6C63FF;
            --primary-dark: #564FD8;
            --primary-light: #8B85FF;
            --secondary: #FF6584;
            --accent: #36D1DC;
            --success: #4CD964;
            --warning: #FF9500;
            --danger: #FF3B30;
            --dark: #1A1D29;
            --darker: #13151F;
            --light: #F8F9FC;
            --gray-100: #F1F3F9;
            --gray-200: #E2E6F3;
            --gray-300: #D4DAEC;
            --gray-400: #C5CEE6;
            --gray-500: #8C96B5;
            --gray-600: #6E7A9A;
            --gray-700: #4A5675;
            --gray-800: #2D3650;
            --gray-900: #1A2236;
            --border-radius: 8px;
            --border-radius-lg: 12px;
            --border-radius-sm: 6px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.2s ease;
            --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            --gradient-accent: linear-gradient(135deg, var(--accent) 0%, var(--primary) 100%);
            --gradient-dark: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
        }

        .dark-mode {
            --light: #1A1D29;
            --gray-100: #1E2230;
            --gray-200: #242837;
            --gray-300: #2D3247;
            --gray-400: #363C56;
            --gray-500: #4A5675;
            --gray-600: #6E7A9A;
            --gray-700: #8C96B5;
            --gray-800: #C5CEE6;
            --gray-900: #E2E6F3;
            --dark: #F8F9FC;
            --darker: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
            transition: var(--transition);
            overflow-x: hidden;
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* PixelKit Header */
        .pixelkit-header {
            background: var(--gradient-dark);
            color: white;
            padding: 1rem 0;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            font-size: 1.75rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 4px rgba(108, 99, 255, 0.3));
        }

        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-subtitle {
            font-size: 0.7rem;
            font-weight: 500;
            color: var(--gray-500);
            margin-top: -2px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* PixelKit Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 0.6rem 1.2rem;
            font-weight: 600;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            font-size: 0.85rem;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 2px 5px rgba(108, 99, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(108, 99, 255, 0.4);
        }

        .btn-success {
            background: var(--success);
            color: white;
            box-shadow: 0 2px 5px rgba(76, 217, 100, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(76, 217, 100, 0.4);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            box-shadow: 0 2px 5px rgba(255, 59, 48, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(255, 59, 48, 0.4);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-light {
            background: var(--gray-100);
            color: var(--dark);
            border: 1px solid var(--gray-300);
        }

        .btn-light:hover {
            background: var(--gray-200);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
            width: 100%;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 1.5rem;
        }

        /* PixelKit Card Styles */
        .card {
            background: var(--light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid var(--gray-200);
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            padding: 1rem;
            background: var(--gradient-dark);
            color: white;
            position: relative;
        }

        .card-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--gradient-primary);
        }

        .card-body {
            padding: 1rem;
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .card-title i {
            font-size: 1.2rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Sidebar Styles */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Preset Styles */
        .preset-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.6rem;
        }

        .preset-card {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0.8rem;
            background: var(--gray-100);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .preset-card:hover {
            background: var(--gray-200);
        }

        .preset-card.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 2px 5px rgba(108, 99, 255, 0.3);
        }

        .preset-icon {
            font-size: 1.2rem;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
        }

        .preset-card.active .preset-icon {
            background: rgba(255, 255, 255, 0.3);
        }

        .preset-info {
            flex: 1;
        }

        .preset-name {
            font-weight: 600;
            margin-bottom: 2px;
            font-size: 0.9rem;
        }

        .preset-desc {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        /* Status Panel */
        .status-panel {
            background: var(--gray-100);
            border-radius: var(--border-radius);
            padding: 1rem;
            position: relative;
            overflow: hidden;
        }

        .status-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-primary);
        }

        .status-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 0.8rem;
        }

        .status-icon {
            font-size: 1rem;
            color: var(--primary);
        }

        .status-modified {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 0.8rem;
            padding: 0.6rem;
            background: rgba(255, 149, 0, 0.1);
            border-radius: var(--border-radius-sm);
            color: var(--warning);
            font-weight: 500;
            font-size: 0.85rem;
        }

        /* Tabs */
        .tabs-container {
            background: var(--light);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .tabs-header {
            display: flex;
            background: var(--gray-100);
            border-bottom: 1px solid var(--gray-200);
            overflow-x: auto;
        }

        .tab {
            padding: 0.8rem 1.2rem;
            cursor: pointer;
            border: none;
            background: none;
            color: var(--gray-600);
            font-weight: 500;
            transition: var(--transition);
            white-space: nowrap;
            position: relative;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
        }

        .tab:hover {
            color: var(--primary);
            background: var(--gray-200);
        }

        .tab.active {
            color: var(--primary);
            background: var(--light);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--gradient-primary);
        }

        .tab-content {
            display: none;
            padding: 1.5rem;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Parameter Groups */
        .parameter-group {
            margin-bottom: 2rem;
        }

        .parameter-group-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1.2rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--gray-200);
        }

        .parameter-group-title i {
            color: var(--primary);
        }

        .parameter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.2rem;
        }

        /* Parameter Cards */
        .parameter-card {
            background: var(--gray-100);
            border-radius: var(--border-radius);
            padding: 1.2rem;
            transition: var(--transition);
            border: 1px solid var(--gray-200);
            position: relative;
            overflow: hidden;
        }

        .parameter-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-primary);
            opacity: 0;
            transition: var(--transition);
        }

        .parameter-card:hover::before {
            opacity: 1;
        }

        .parameter-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .parameter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.8rem;
        }

        .parameter-info {
            flex: 1;
        }

        .parameter-name {
            font-weight: 600;
            margin-bottom: 0.2rem;
            font-size: 1rem;
        }

        .parameter-default {
            font-size: 0.8rem;
            color: var(--gray-600);
        }

        .parameter-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary);
            background: rgba(108, 99, 255, 0.1);
            padding: 0.2rem 0.4rem;
            border-radius: var(--border-radius-sm);
        }

        .parameter-controls {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .slider-container input[type="range"] {
            flex: 1;
            height: 5px;
            border-radius: 3px;
            background: var(--gray-300);
            outline: none;
            -webkit-appearance: none;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(108, 99, 255, 0.4);
            transition: var(--transition);
        }

        .slider-container input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        .slider-container input[type="number"] {
            width: 70px;
            padding: 0.4rem;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-sm);
            background: var(--light);
            color: var(--dark);
            font-weight: 500;
            text-align: center;
            font-size: 0.85rem;
        }

        .highlight {
            background: rgba(76, 217, 100, 0.2);
            color: var(--success);
            padding: 2px 6px;
            border-radius: var(--border-radius-sm);
            font-size: 0.8rem;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        /* Footer */
        .pixelkit-footer {
            background: var(--gradient-dark);
            color: white;
            padding: 1.5rem 0;
            margin-top: 2rem;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-text {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .footer-version {
            font-weight: 600;
            color: var(--primary-light);
        }

        /* Social Media Links */
        .social-links {
            display: flex;
            gap: 0.8rem;
            align-items: center;
            margin-bottom: 0.8rem;
        }

        .social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transition: var(--transition);
            text-decoration: none;
            font-size: 0.9rem;
        }

        .social-link:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }

        .copyright {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            opacity: 0.9;
            margin-top: 0.5rem;
        }

        .copyright-icon {
            color: var(--primary-light);
        }

        /* Footer layout adjustments */
        .footer-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .footer-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 1rem;
            margin-top: 1rem;
        }

        /* Suspension Preview Styles */
        .suspension-preview-container {
            background: var(--gray-100);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 2rem;
            border: 1px solid var(--gray-300);
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .preview-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .preview-controls {
            display: flex;
            gap: 0.8rem;
        }

        .preview-canvas-container {
            position: relative;
            width: 100%;
            height: 300px;
            background: linear-gradient(180deg, #87CEEB 0%, #98FB98 100%);
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 2px solid var(--gray-300);
        }

        #suspensionPreview {
            width: 100%;
            height: 100%;
        }

        .road-surface {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background: linear-gradient(180deg, #654321 0%, #3D2502 100%);
            border-top: 2px solid #2A1A01;
        }

        .preview-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
            padding: 1rem;
            background: var(--gray-200);
            border-radius: var(--border-radius);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--gray-600);
            margin-top: 0.2rem;
        }

        .bump-indicator {
            position: absolute;
            bottom: 40px;
            width: 30px;
            height: 15px;
            background: #FF6B6B;
            border-radius: 4px 4px 0 0;
            transform: translateX(-50%);
            transition: left 0.3s ease;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
            }
            
            .editor-area {
                order: 1;
            }
            
            .parameter-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 0.8rem;
                text-align: center;
            }
            
            .action-buttons {
                justify-content: center;
            }
            
            .footer-content, .footer-main, .footer-bottom {
                flex-direction: column;
                gap: 0.8rem;
                text-align: center;
            }
            
            .tabs-header {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: 110px;
                justify-content: center;
            }

            .preview-controls {
                flex-direction: column;
            }

            .preview-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Dark mode toggle */
        .theme-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(15deg);
        }

        /* SII Preview */
        .sii-preview {
            background: var(--gray-100);
            border-radius: var(--border-radius);
            padding: 1.2rem;
            margin-top: 1.5rem;
            font-family: monospace;
            font-size: 0.85rem;
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid var(--gray-300);
        }

        .sii-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
        }

        .sii-preview-title {
            font-weight: 600;
            color: var(--primary);
        }

        /* Custom Animated Icons */
        .animated-icon {
            position: relative;
            display: inline-block;
        }

        .bus-icon {
            animation: bus-move 3s ease-in-out infinite;
        }

        .suspension-icon {
            animation: suspension-bounce 2s ease-in-out infinite;
        }

        .tire-icon {
            animation: tire-rotate 4s linear infinite;
        }

        .transmission-icon {
            animation: transmission-spin 3s ease-in-out infinite;
        }

        .brake-icon {
            animation: brake-pulse 2s ease-in-out infinite;
        }

        @keyframes bus-move {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        @keyframes suspension-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        @keyframes tire-rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes transmission-spin {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(90deg); }
            50% { transform: rotate(180deg); }
            75% { transform: rotate(270deg); }
        }

        @keyframes brake-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Custom Suspension Icon */
        .custom-suspension-icon {
            position: relative;
            width: 20px;
            height: 20px;
            display: inline-block;
        }

        .suspension-line {
            position: absolute;
            width: 2px;
            height: 100%;
            background-color: currentColor;
            left: 50%;
            transform: translateX(-50%);
        }

        .suspension-spring {
            position: absolute;
            width: 10px;
            height: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-left: 2px solid currentColor;
            border-right: 2px solid currentColor;
            animation: spring-bounce 2s ease-in-out infinite;
        }

        .suspension-wheel {
            position: absolute;
            width: 14px;
            height: 14px;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            border: 2px solid currentColor;
            border-radius: 50%;
            animation: wheel-rotate 3s linear infinite;
        }

        @keyframes spring-bounce {
            0%, 100% { height: 100%; }
            50% { height: 70%; }
        }

        @keyframes wheel-rotate {
            0% { transform: translateX(-50%) rotate(0deg); }
            100% { transform: translateX(-50%) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- PixelKit Header -->
        <header class="pixelkit-header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-bus animated-icon bus-icon"></i>
                    </div>
                    <div>
                        <div class="logo-text">SCS Bus Physics Editor</div>
                        <div class="logo-subtitle">COMPLETE BUS PHYSICS CUSTOMIZATION</div>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-light btn-sm" id="helpBtn">
                        <i class="fas fa-question-circle"></i> Help
                    </button>
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary" id="importBtn">
                    <i class="fas fa-file-import"></i> Import .sii
                </button>
                <button class="btn btn-success" id="exportBtn">
                    <i class="fas fa-file-export"></i> Export .sii
                </button>
                <button class="btn btn-outline" id="undoBtn">
                    <i class="fas fa-undo"></i> Undo
                </button>
                <button class="btn btn-outline" id="redoBtn">
                    <i class="fas fa-redo"></i> Redo
                </button>
                <button class="btn btn-danger" id="resetBtn">
                    <i class="fas fa-eraser"></i> Reset to Default
                </button>
                <input type="file" id="fileInput" accept=".sii" style="display: none;">
            </div>

            <div class="content-grid">
                <!-- Sidebar -->
                <div class="sidebar">
                    <!-- Presets Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-sliders-h"></i> Suspension Presets
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="preset-grid">
                                <div class="preset-card active" data-preset="default">
                                    <div class="preset-icon">
                                        <i class="fas fa-cog"></i>
                                    </div>
                                    <div class="preset-info">
                                        <div class="preset-name">Default</div>
                                        <div class="preset-desc">Standard factory settings</div>
                                    </div>
                                </div>
                                <div class="preset-card" data-preset="air">
                                    <div class="preset-icon">
                                        <i class="fas fa-wind"></i>
                                    </div>
                                    <div class="preset-info">
                                        <div class="preset-name">Air Suspension</div>
                                        <div class="preset-desc">Smooth ride for long hauls</div>
                                    </div>
                                </div>
                                <div class="preset-card" data-preset="leaf">
                                    <div class="preset-icon">
                                        <i class="fas fa-layer-group"></i>
                                    </div>
                                    <div class="preset-info">
                                        <div class="preset-name">Leaf Suspension</div>
                                        <div class="preset-desc">Heavy-duty for off-road</div>
                                    </div>
                                </div>
                                <div class="preset-card" data-preset="heavy">
                                    <div class="preset-icon">
                                        <i class="fas fa-weight-hanging"></i>
                                    </div>
                                    <div class="preset-info">
                                        <div class="preset-name">Heavy Duty</div>
                                        <div class="preset-desc">Maximum load capacity</div>
                                    </div>
                                </div>
                                <div class="preset-card" data-preset="sport">
                                    <div class="preset-icon">
                                        <i class="fas fa-tachometer-alt"></i>
                                    </div>
                                    <div class="preset-info">
                                        <div class="preset-name">Sport Suspension</div>
                                        <div class="preset-desc">Enhanced handling & response</div>
                                    </div>
                                </div>
                                <div class="preset-card" data-preset="custom">
                                    <div class="preset-icon">
                                        <i class="fas fa-user-cog"></i>
                                    </div>
                                    <div class="preset-info">
                                        <div class="preset-name">Custom</div>
                                        <div class="preset-desc">Your personalized settings</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Panel -->
                    <div class="status-panel">
                        <div class="status-header">
                            <i class="fas fa-info-circle status-icon"></i>
                            <h4>Status Panel</h4>
                        </div>
                        <div id="statusText">No file loaded. Select a preset or import a .sii file to begin.</div>
                        <div id="modifiedStatus" class="status-modified" style="display: none;">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Modified - Remember to export your changes</span>
                        </div>
                    </div>
                </div>

                <!-- Editor Area -->
                <div class="editor-area">
                    <div class="tabs-container">
                        <div class="tabs-header">
                            <button class="tab active" data-tab="steering">
                                <i class="fas fa-bus bus-icon"></i> Steering
                            </button>
                            <button class="tab" data-tab="brakes">
                                <i class="fas fa-stop-circle brake-icon"></i> Brakes
                            </button>
                            <button class="tab" data-tab="cabin">
                                <i class="fas fa-chair"></i> Cabin
                            </button>
                            <button class="tab" data-tab="suspension">
                                <div class="custom-suspension-icon suspension-icon">
                                    <div class="suspension-line"></div>
                                    <div class="suspension-spring"></div>
                                    <div class="suspension-wheel"></div>
                                </div> Suspension
                            </button>
                            <button class="tab" data-tab="transmission">
                                <i class="fas fa-cogs transmission-icon"></i> Transmission
                            </button>
                            <button class="tab" data-tab="tires">
                                <i class="fas fa-tire tire-icon"></i> Tires
                            </button>
                            <button class="tab" data-tab="advanced">
                                <i class="fas fa-cogs"></i> Advanced
                            </button>
                        </div>

                        <div class="tabs-content">
                            <!-- Steering Tab -->
                            <div class="tab-content active" id="steering-tab">
                                <div class="parameter-group">
                                    <h3 class="parameter-group-title">
                                        <i class="fas fa-bus bus-icon"></i> Steering Parameters
                                    </h3>
                                    <div class="parameter-grid">
                                        <!-- Steering Speed Coefficient -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Steering Speed Coefficient</div>
                                                    <div class="parameter-default">Default: 4.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="steering_speed_coef_val">4.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="steering_speed_coef" min="0.1" max="10.0" step="0.1" value="4.0">
                                                    <input type="number" id="steering_speed_coef_num" min="0.1" max="10.0" step="0.1" value="4.0">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Steering Angle Coefficient -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Steering Angle Coefficient</div>
                                                    <div class="parameter-default">Default: 2.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="steering_angle_coef_val">2.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="steering_angle_coef" min="0.1" max="5.0" step="0.1" value="2.0">
                                                    <input type="number" id="steering_angle_coef_num" min="0.1" max="5.0" step="0.1" value="2.0">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Steering Ratio Coefficient -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Steering Ratio Coefficient</div>
                                                    <div class="parameter-default">Default: 0.95</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="steering_ratio_coef_val">0.95</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="steering_ratio_coef" min="0.1" max="2.0" step="0.01" value="0.95">
                                                    <input type="number" id="steering_ratio_coef_num" min="0.1" max="2.0" step="0.01" value="0.95">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Max Visual Rotation -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Max Visual Rotation</div>
                                                    <div class="parameter-default">Default: 45.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="max_visual_rotation_val">45.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="max_visual_rotation" min="30.0" max="80.0" step="1.0" value="45.0">
                                                    <input type="number" id="max_visual_rotation_num" min="30.0" max="80.0" step="1.0" value="45.0">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Brakes Tab -->
                            <div class="tab-content" id="brakes-tab">
                                <div class="parameter-group">
                                    <h3 class="parameter-group-title">
                                        <i class="fas fa-stop-circle brake-icon"></i> Brake Parameters
                                    </h3>
                                    <div class="parameter-grid">
                                        <!-- Brake Torque Factor -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Brake Torque Factor</div>
                                                    <div class="parameter-default">Default: 2.3</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="brake_torque_factor_val">2.3</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="brake_torque_factor" min="0.5" max="5.0" step="0.1" value="2.3">
                                                    <input type="number" id="brake_torque_factor_num" min="0.5" max="5.0" step="0.1" value="2.3">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Braking Curve Peak -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Braking Curve Peak</div>
                                                    <div class="parameter-default">Default: 1.5</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="braking_curve_peak_rel_val">1.5</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="braking_curve_peak_rel" min="0.5" max="3.0" step="0.1" value="1.5">
                                                    <input type="number" id="braking_curve_peak_rel_num" min="0.5" max="3.0" step="0.1" value="1.5">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Brake Characteristic RPM -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Brake Characteristic RPM</div>
                                                    <div class="parameter-default">Default: 250.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="brake_characteristic_rpm_val">250.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="brake_characteristic_rpm" min="100.0" max="1000.0" step="10.0" value="250.0">
                                                    <input type="number" id="brake_characteristic_rpm_num" min="100.0" max="1000.0" step="10.0" value="250.0">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Brake Balance -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Brake Balance</div>
                                                    <div class="parameter-default">Default: 1.1</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="brake_balance_val">1.1</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="brake_balance" min="0.5" max="2.0" step="0.05" value="1.1">
                                                    <input type="number" id="brake_balance_num" min="0.5" max="2.0" step="0.05" value="1.1">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Cabin Tab -->
                            <div class="tab-content" id="cabin-tab">
                                <div class="parameter-group">
                                    <h3 class="parameter-group-title">
                                        <i class="fas fa-chair"></i> Cabin Parameters
                                    </h3>
                                    <div class="parameter-grid">
                                        <!-- Cabin Max Pitch Angle Front -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Cabin Max Pitch Angle Front</div>
                                                    <div class="parameter-default">Default: 2.25</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="cabin_max_pitch_angle_front_val">2.25</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="cabin_max_pitch_angle_front" min="1.0" max="10.0" step="0.25" value="2.25">
                                                    <input type="number" id="cabin_max_pitch_angle_front_num" min="1.0" max="10.0" step="0.25" value="2.25">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Cabin Max Pitch Angle Rear -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Cabin Max Pitch Angle Rear</div>
                                                    <div class="parameter-default">Default: 2.25</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="cabin_max_pitch_angle_rear_val">2.25</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="cabin_max_pitch_angle_rear" min="1.0" max="10.0" step="0.25" value="2.25">
                                                    <input type="number" id="cabin_max_pitch_angle_rear_num" min="1.0" max="10.0" step="0.25" value="2.25">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Cabin Max Roll Angle -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Cabin Max Roll Angle</div>
                                                    <div class="parameter-default">Default: 2.25</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="cabin_max_roll_angle_val">2.25</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="cabin_max_roll_angle" min="1.0" max="10.0" step="0.25" value="2.25">
                                                    <input type="number" id="cabin_max_roll_angle_num" min="1.0" max="10.0" step="0.25" value="2.25">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Suspension Tab -->
                            <div class="tab-content" id="suspension-tab">
                                <div class="parameter-group">
                                    <h3 class="parameter-group-title">
                                        <div class="custom-suspension-icon suspension-icon">
                                            <div class="suspension-line"></div>
                                            <div class="suspension-spring"></div>
                                            <div class="suspension-wheel"></div>
                                        </div> Suspension Parameters
                                    </h3>
                                    <div class="parameter-grid">
                                        <!-- Damping Scaling Front Factor -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Damping Scaling Front Factor</div>
                                                    <div class="parameter-default">Default: 0.25</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="damping_scaling_front_factor_val">0.25</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="damping_scaling_front_factor" min="0.1" max="3.0" step="0.1" value="0.25">
                                                    <input type="number" id="damping_scaling_front_factor_num" min="0.1" max="3.0" step="0.1" value="0.25">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Damping Scaling Rear Factor -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Damping Scaling Rear Factor</div>
                                                    <div class="parameter-default">Default: 1.25</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="damping_scaling_rear_factor_val">1.25</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="damping_scaling_rear_factor" min="0.1" max="3.0" step="0.1" value="1.25">
                                                    <input type="number" id="damping_scaling_rear_factor_num" min="0.1" max="3.0" step="0.1" value="1.25">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Damping Scaling Trailer Factor -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Damping Scaling Trailer Factor</div>
                                                    <div class="parameter-default">Default: 1.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="damping_scaling_trailer_factor_val">1.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="damping_scaling_trailer_factor" min="0.1" max="3.0" step="0.1" value="1.0">
                                                    <input type="number" id="damping_scaling_trailer_factor_num" min="0.1" max="3.0" step="0.1" value="1.0">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Sway Bar Stiffness Factor -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Sway Bar Stiffness Factor</div>
                                                    <div class="parameter-default">Default: 3.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="sway_bar_stiffness_factor_val">3.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="sway_bar_stiffness_factor" min="0.1" max="10.0" step="0.1" value="3.0">
                                                    <input type="number" id="sway_bar_stiffness_factor_num" min="0.1" max="10.0" step="0.1" value="3.0">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Suspension Preview Section -->
                                <div class="suspension-preview-container">
                                    <div class="preview-header">
                                        <h3 class="preview-title">
                                            <i class="fas fa-eye"></i> Suspension Preview
                                        </h3>
                                        <div class="preview-controls">
                                            <button class="btn btn-primary btn-sm" id="testSuspension">
                                                <i class="fas fa-bolt"></i> Test Suspension
                                            </button>
                                            <button class="btn btn-outline btn-sm" id="autoBump">
                                                <i class="fas fa-sync"></i> Auto-bump
                                            </button>
                                            <button class="btn btn-light btn-sm" id="resetPreview">
                                                <i class="fas fa-undo"></i> Reset
                                            </button>
                                        </div>
                                    </div>
                                    <div class="preview-canvas-container">
                                        <canvas id="suspensionPreview"></canvas>
                                        <div class="road-surface"></div>
                                        <div class="bump-indicator" id="bumpIndicator" style="left: 50%;"></div>
                                    </div>
                                    <div class="preview-stats">
                                        <div class="stat-item">
                                            <div class="stat-value" id="frontTravel">0.0</div>
                                            <div class="stat-label">Front Travel</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-value" id="rearTravel">0.0</div>
                                            <div class="stat-label">Rear Travel</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-value" id="bodyRoll">0.0</div>
                                            <div class="stat-label">Body Roll</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Transmission Tab -->
                            <div class="tab-content" id="transmission-tab">
                                <div class="parameter-group">
                                    <h3 class="parameter-group-title">
                                        <i class="fas fa-cogs transmission-icon"></i> Transmission Parameters
                                    </h3>
                                    <div class="parameter-grid">
                                        <!-- Transmission Viscosity Factor -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Transmission Viscosity Factor</div>
                                                    <div class="parameter-default">Default: 1.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="transmission_viscosity_factor_val">1.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="transmission_viscosity_factor" min="0.1" max="3.0" step="0.1" value="1.0">
                                                    <input type="number" id="transmission_viscosity_factor_num" min="0.1" max="3.0" step="0.1" value="1.0">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Transmission Viscosity Retarder Factor -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Transmission Retarder Viscosity</div>
                                                    <div class="parameter-default">Default: 1.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="transmission_viscosity_retarder_factor_val">1.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="transmission_viscosity_retarder_factor" min="0.1" max="3.0" step="0.1" value="1.0">
                                                    <input type="number" id="transmission_viscosity_retarder_factor_num" min="0.1" max="3.0" step="0.1" value="1.0">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Torque Converter Viscosity Factor -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Torque Converter Viscosity</div>
                                                    <div class="parameter-default">Default: 0.2</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="torque_converter_viscosity_factor_val">0.2</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="torque_converter_viscosity_factor" min="0.1" max="2.0" step="0.1" value="0.2">
                                                    <input type="number" id="torque_converter_viscosity_factor_num" min="0.1" max="2.0" step="0.1" value="0.2">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Torque Converter Locked Viscosity -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Torque Converter Locked Viscosity</div>
                                                    <div class="parameter-default">Default: 10.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="torque_converter_locked_viscosity_factor_val">10.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="torque_converter_locked_viscosity_factor" min="5.0" max="20.0" step="0.5" value="10.0">
                                                    <input type="number" id="torque_converter_locked_viscosity_factor_num" min="5.0" max="20.0" step="0.5" value="10.0">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tires Tab -->
                            <div class="tab-content" id="tires-tab">
                                <div class="parameter-group">
                                    <h3 class="parameter-group-title">
                                        <i class="fas fa-tire tire-icon"></i> Tire Parameters
                                    </h3>
                                    <div class="parameter-grid">
                                        <!-- Bristle Stiffness Longitudinal Factor -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Longitudinal Stiffness Factor</div>
                                                    <div class="parameter-default">Default: 1.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="bristle_stiffness_longitudinal_factor_val">1.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="bristle_stiffness_longitudinal_factor" min="0.1" max="3.0" step="0.1" value="1.0">
                                                    <input type="number" id="bristle_stiffness_longitudinal_factor_num" min="0.1" max="3.0" step="0.1" value="1.0">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Bristle Stiffness Lateral Factor -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Lateral Stiffness Factor</div>
                                                    <div class="parameter-default">Default: 1.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="bristle_stiffness_lateral_factor_val">1.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="bristle_stiffness_lateral_factor" min="0.1" max="3.0" step="0.1" value="1.0">
                                                    <input type="number" id="bristle_stiffness_lateral_factor_num" min="0.1" max="3.0" step="0.1" value="1.0">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Bristle Damping Longitudinal Factor -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Longitudinal Damping Factor</div>
                                                    <div class="parameter-default">Default: 1.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="bristle_damping_longitudinal_factor_val">1.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="bristle_damping_longitudinal_factor" min="0.1" max="3.0" step="0.1" value="1.0">
                                                    <input type="number" id="bristle_damping_longitudinal_factor_num" min="0.1" max="3.0" step="0.1" value="1.0">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Bristle Damping Lateral Factor -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Lateral Damping Factor</div>
                                                    <div class="parameter-default">Default: 1.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="bristle_damping_lateral_factor_val">1.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="bristle_damping_lateral_factor" min="0.1" max="3.0" step="0.1" value="1.0">
                                                    <input type="number" id="bristle_damping_lateral_factor_num" min="0.1" max="3.0" step="0.1" value="1.0">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Advanced Tab -->
                            <div class="tab-content" id="advanced-tab">
                                <div class="parameter-group">
                                    <h3 class="parameter-group-title">
                                        <i class="fas fa-cogs"></i> Advanced Parameters
                                    </h3>
                                    <div class="parameter-grid">
                                        <!-- Air Resistance -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Air Resistance</div>
                                                    <div class="parameter-default">Default: 2.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="air_resistance_val">2.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="air_resistance" min="0.5" max="5.0" step="0.1" value="2.0">
                                                    <input type="number" id="air_resistance_num" min="0.5" max="5.0" step="0.1" value="2.0">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Inertia Scaling Constant -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Inertia Scaling Constant</div>
                                                    <div class="parameter-default">Default: 1.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="inertia_scaling_const_val">1.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="inertia_scaling_const" min="0.1" max="3.0" step="0.1" value="1.0">
                                                    <input type="number" id="inertia_scaling_const_num" min="0.1" max="3.0" step="0.1" value="1.0">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Transmission Relative Flywheel Inertia -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Flywheel Inertia Ratio</div>
                                                    <div class="parameter-default">Default: 0.5</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="transmission_rel_flywheel_inertia_val">0.5</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="transmission_rel_flywheel_inertia" min="0.1" max="2.0" step="0.1" value="0.5">
                                                    <input type="number" id="transmission_rel_flywheel_inertia_num" min="0.1" max="2.0" step="0.1" value="0.5">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Wheel Mass -->
                                        <div class="parameter-card">
                                            <div class="parameter-header">
                                                <div class="parameter-info">
                                                    <div class="parameter-name">Wheel Mass</div>
                                                    <div class="parameter-default">Default: 105.0</div>
                                                </div>
                                                <div class="parameter-value">Current: <span id="wheel_mass_val">105.0</span></div>
                                            </div>
                                            <div class="parameter-controls">
                                                <div class="slider-container">
                                                    <input type="range" id="wheel_mass" min="50.0" max="200.0" step="5.0" value="105.0">
                                                    <input type="number" id="wheel_mass_num" min="50.0" max="200.0" step="5.0" value="105.0">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SII Preview -->
                    <div class="sii-preview">
                        <div class="sii-preview-header">
                            <div class="sii-preview-title">SII File Preview</div>
                            <button class="btn btn-sm btn-outline" id="refreshPreview">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        <pre id="siiPreview">SiiNunit
{
physics_data: .phdata
{
    version: 2

    // Your SII file will be previewed here
}</pre>
                    </div>
                </div>
            </div>
        </main>

        <!-- PixelKit Footer -->
        <footer class="pixelkit-footer">
            <div class="footer-content">
                <div class="footer-main">
                    <div class="footer-text">
                        <span class="footer-version">SCS Bus Physics Editor v3.0</span> - Compatible with SCS Bus Simulator 1.42 to 1.50+
                    </div>
                    <div class="social-links">
                        <a href="https://instagram.com/mechawraith" target="_blank" class="social-link">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://facebook.com/bussmith3d" target="_blank" class="social-link">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://discord.com/users/scorpionz8" target="_blank" class="social-link">
                            <i class="fab fa-discord"></i>
                        </a>
                    </div>
                </div>
                <div class="footer-bottom">
                    <div class="footer-text">
                        Built with <i class="fas fa-heart" style="color: var(--secondary);"></i> for the bus simulation community
                    </div>
                    <div class="copyright">
                        <i class="fas fa-copyright copyright-icon"></i> 2023 Nirob Islam. All rights reserved.
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Application state
        const state = {
            currentPreset: 'default',
            isModified: false,
            history: [],
            historyIndex: -1,
            originalValues: {},
            currentValues: {}
        };

        // Complete preset configurations based on the SII file
        const presets = {
            default: {
                version: 2,
                steering_speed_coef: 4.0,
                steering_angle_coef: 2.0,
                steering_ratio_coef: 0.95,
                max_visual_rotation: 45.0,
                steering_sensitivity_multiplier_0kmh: 1.0,
                steering_sensitivity_multiplier_100kmh: 0.4,
                steering_sensitivity_multiplier_minimum: 0.2,
                steering_sensitivity_multiplier_maximum: 10.0,
                fifth_wheel_pitch: 0,
                fifth_wheel_roll: 0,
                trailer_joint_pitch: 0,
                trailer_joint_roll: 0,
                spreader_joint_pitch: 0,
                spreader_joint_roll: 0,
                brake_torque_factor: 2.3,
                braking_curve_peak_rel: 1.5,
                brake_characteristic_rpm: 250.0,
                brake_balance: 1.1,
                max_brake_temperature: 200.0,
                brake_cooling_rate: 0.01,
                brake_friction_warming_rate: 4.0,
                cabin_max_pitch_angle_front: 2.25,
                cabin_max_pitch_angle_rear: 2.25,
                cabin_max_roll_angle: 2.25,
                cabin_suspension_travel: 0.05,
                cabin_suspension_damping_factor: 1.0,
                cabin_sway_bar_factor: 1.0,
                cabin_cog_height_offset: 0.5,
                cabin_mass: 0,
                wheel_mass: 105.0,
                damping_scaling_front_factor: 0.25,
                damping_scaling_rear_factor: 1.25,
                damping_scaling_trailer_factor: 1.0,
                sway_bar_stiffness_factor: 3,
                thrust_characteristic_viscosity_factor: 1.0,
                transmission_viscosity_factor: 1.0,
                transmission_viscosity_retarder_factor: 1.0,
                wheel_viscosity_factor: 1.0,
                clutch_viscosity_factor: 1.0,
                clutch_connected_viscosity_factor: 10.0,
                manual_clutch_viscosity_factor: 0.5,
                manual_clutch_connected_viscosity_factor: 10.0,
                torque_converter_viscosity_factor: 0.2,
                torque_converter_locked_viscosity_factor: 10.0,
                inertia_scaling_const: 1.0,
                transmission_rel_flywheel_inertia: 0.5,
                air_resistance: 2.0,
                bristle_stiffness_longitudinal_factor: 1.0,
                bristle_stiffness_lateral_factor: 1.0,
                bristle_damping_longitudinal_factor: 1.0,
                bristle_damping_lateral_factor: 1.0,
                slip_longitudinal_factor: 2.0,
                slip_lateral_factor: 2.0
            },
            air: {
                version: 2,
                steering_speed_coef: 1.2,
                steering_angle_coef: 1.1,
                steering_ratio_coef: 0.95,
                max_visual_rotation: 55.0,
                steering_sensitivity_multiplier_0kmh: 1.0,
                steering_sensitivity_multiplier_100kmh: 0.4,
                steering_sensitivity_multiplier_minimum: 0.2,
                steering_sensitivity_multiplier_maximum: 10.0,
                fifth_wheel_pitch: 0,
                fifth_wheel_roll: 0,
                trailer_joint_pitch: 0,
                trailer_joint_roll: 0,
                spreader_joint_pitch: 0,
                spreader_joint_roll: 0,
                brake_torque_factor: 1.1,
                braking_curve_peak_rel: 1.5,
                brake_characteristic_rpm: 250.0,
                brake_balance: 0.45,
                max_brake_temperature: 850.0,
                brake_cooling_rate: 0.01,
                brake_friction_warming_rate: 4.0,
                cabin_max_pitch_angle_front: 6.0,
                cabin_max_pitch_angle_rear: 6.0,
                cabin_max_roll_angle: 6.0,
                cabin_suspension_travel: 0.2,
                cabin_suspension_damping_factor: 1.3,
                cabin_sway_bar_factor: 1.0,
                cabin_cog_height_offset: 0.5,
                cabin_mass: 1200.0,
                wheel_mass: 105.0,
                damping_scaling_front_factor: 1.3,
                damping_scaling_rear_factor: 1.4,
                damping_scaling_trailer_factor: 1.0,
                sway_bar_stiffness_factor: 0.8,
                thrust_characteristic_viscosity_factor: 1.1,
                transmission_viscosity_factor: 1.1,
                transmission_viscosity_retarder_factor: 1.0,
                wheel_viscosity_factor: 1.0,
                clutch_viscosity_factor: 1.0,
                clutch_connected_viscosity_factor: 10.0,
                manual_clutch_viscosity_factor: 0.5,
                manual_clutch_connected_viscosity_factor: 10.0,
                torque_converter_viscosity_factor: 0.2,
                torque_converter_locked_viscosity_factor: 10.0,
                inertia_scaling_const: 1.2,
                transmission_rel_flywheel_inertia: 0.5,
                air_resistance: 2.0,
                bristle_stiffness_longitudinal_factor: 1.0,
                bristle_stiffness_lateral_factor: 1.0,
                bristle_damping_longitudinal_factor: 1.0,
                bristle_damping_lateral_factor: 1.0,
                slip_longitudinal_factor: 1.1,
                slip_lateral_factor: 1.1
            },
            leaf: {
                version: 2,
                steering_speed_coef: 0.9,
                steering_angle_coef: 0.9,
                steering_ratio_coef: 0.95,
                max_visual_rotation: 45.0,
                steering_sensitivity_multiplier_0kmh: 1.0,
                steering_sensitivity_multiplier_100kmh: 0.4,
                steering_sensitivity_multiplier_minimum: 0.2,
                steering_sensitivity_multiplier_maximum: 10.0,
                fifth_wheel_pitch: 0,
                fifth_wheel_roll: 0,
                trailer_joint_pitch: 0,
                trailer_joint_roll: 0,
                spreader_joint_pitch: 0,
                spreader_joint_roll: 0,
                brake_torque_factor: 1.2,
                braking_curve_peak_rel: 1.5,
                brake_characteristic_rpm: 250.0,
                brake_balance: 0.55,
                max_brake_temperature: 900.0,
                brake_cooling_rate: 0.01,
                brake_friction_warming_rate: 4.0,
                cabin_max_pitch_angle_front: 4.0,
                cabin_max_pitch_angle_rear: 4.0,
                cabin_max_roll_angle: 4.0,
                cabin_suspension_travel: 0.1,
                cabin_suspension_damping_factor: 1.0,
                cabin_sway_bar_factor: 1.0,
                cabin_cog_height_offset: 0.5,
                cabin_mass: 1500.0,
                wheel_mass: 105.0,
                damping_scaling_front_factor: 0.8,
                damping_scaling_rear_factor: 0.7,
                damping_scaling_trailer_factor: 1.0,
                sway_bar_stiffness_factor: 1.5,
                thrust_characteristic_viscosity_factor: 0.9,
                transmission_viscosity_factor: 0.9,
                transmission_viscosity_retarder_factor: 1.0,
                wheel_viscosity_factor: 1.0,
                clutch_viscosity_factor: 1.0,
                clutch_connected_viscosity_factor: 10.0,
                manual_clutch_viscosity_factor: 0.5,
                manual_clutch_connected_viscosity_factor: 10.0,
                torque_converter_viscosity_factor: 0.2,
                torque_converter_locked_viscosity_factor: 10.0,
                inertia_scaling_const: 0.8,
                transmission_rel_flywheel_inertia: 0.5,
                air_resistance: 2.0,
                bristle_stiffness_longitudinal_factor: 1.0,
                bristle_stiffness_lateral_factor: 1.0,
                bristle_damping_longitudinal_factor: 1.0,
                bristle_damping_lateral_factor: 1.0,
                slip_longitudinal_factor: 0.9,
                slip_lateral_factor: 0.9
            },
            heavy: {
                version: 2,
                steering_speed_coef: 0.8,
                steering_angle_coef: 0.8,
                steering_ratio_coef: 0.95,
                max_visual_rotation: 40.0,
                steering_sensitivity_multiplier_0kmh: 1.0,
                steering_sensitivity_multiplier_100kmh: 0.4,
                steering_sensitivity_multiplier_minimum: 0.2,
                steering_sensitivity_multiplier_maximum: 10.0,
                fifth_wheel_pitch: 0,
                fifth_wheel_roll: 0,
                trailer_joint_pitch: 0,
                trailer_joint_roll: 0,
                spreader_joint_pitch: 0,
                spreader_joint_roll: 0,
                brake_torque_factor: 1.5,
                braking_curve_peak_rel: 1.5,
                brake_characteristic_rpm: 250.0,
                brake_balance: 0.6,
                max_brake_temperature: 1000.0,
                brake_cooling_rate: 0.01,
                brake_friction_warming_rate: 4.0,
                cabin_max_pitch_angle_front: 3.0,
                cabin_max_pitch_angle_rear: 3.0,
                cabin_max_roll_angle: 3.0,
                cabin_suspension_travel: 0.08,
                cabin_suspension_damping_factor: 1.0,
                cabin_sway_bar_factor: 1.0,
                cabin_cog_height_offset: 0.5,
                cabin_mass: 2000.0,
                wheel_mass: 105.0,
                damping_scaling_front_factor: 1.6,
                damping_scaling_rear_factor: 1.7,
                damping_scaling_trailer_factor: 1.0,
                sway_bar_stiffness_factor: 1.8,
                thrust_characteristic_viscosity_factor: 1.3,
                transmission_viscosity_factor: 1.3,
                transmission_viscosity_retarder_factor: 1.0,
                wheel_viscosity_factor: 1.0,
                clutch_viscosity_factor: 1.0,
                clutch_connected_viscosity_factor: 10.0,
                manual_clutch_viscosity_factor: 0.5,
                manual_clutch_connected_viscosity_factor: 10.0,
                torque_converter_viscosity_factor: 0.2,
                torque_converter_locked_viscosity_factor: 10.0,
                inertia_scaling_const: 1.5,
                transmission_rel_flywheel_inertia: 0.5,
                air_resistance: 2.0,
                bristle_stiffness_longitudinal_factor: 1.0,
                bristle_stiffness_lateral_factor: 1.0,
                bristle_damping_longitudinal_factor: 1.0,
                bristle_damping_lateral_factor: 1.0,
                slip_longitudinal_factor: 1.3,
                slip_lateral_factor: 1.3
            },
            sport: {
                version: 2,
                steering_speed_coef: 1.5,
                steering_angle_coef: 1.4,
                steering_ratio_coef: 0.95,
                max_visual_rotation: 60.0,
                steering_sensitivity_multiplier_0kmh: 1.0,
                steering_sensitivity_multiplier_100kmh: 0.4,
                steering_sensitivity_multiplier_minimum: 0.2,
                steering_sensitivity_multiplier_maximum: 10.0,
                fifth_wheel_pitch: 0,
                fifth_wheel_roll: 0,
                trailer_joint_pitch: 0,
                trailer_joint_roll: 0,
                spreader_joint_pitch: 0,
                spreader_joint_roll: 0,
                brake_torque_factor: 1.3,
                braking_curve_peak_rel: 1.5,
                brake_characteristic_rpm: 250.0,
                brake_balance: 0.4,
                max_brake_temperature: 700.0,
                brake_cooling_rate: 0.01,
                brake_friction_warming_rate: 4.0,
                cabin_max_pitch_angle_front: 7.0,
                cabin_max_pitch_angle_rear: 7.0,
                cabin_max_roll_angle: 7.0,
                cabin_suspension_travel: 0.12,
                cabin_suspension_damping_factor: 1.0,
                cabin_sway_bar_factor: 1.0,
                cabin_cog_height_offset: 0.5,
                cabin_mass: 800.0,
                wheel_mass: 105.0,
                damping_scaling_front_factor: 1.1,
                damping_scaling_rear_factor: 1.1,
                damping_scaling_trailer_factor: 1.0,
                sway_bar_stiffness_factor: 1.2,
                thrust_characteristic_viscosity_factor: 0.8,
                transmission_viscosity_factor: 0.8,
                transmission_viscosity_retarder_factor: 1.0,
                wheel_viscosity_factor: 1.0,
                clutch_viscosity_factor: 1.0,
                clutch_connected_viscosity_factor: 10.0,
                manual_clutch_viscosity_factor: 0.5,
                manual_clutch_connected_viscosity_factor: 10.0,
                torque_converter_viscosity_factor: 0.2,
                torque_converter_locked_viscosity_factor: 10.0,
                inertia_scaling_const: 0.7,
                transmission_rel_flywheel_inertia: 0.5,
                air_resistance: 2.0,
                bristle_stiffness_longitudinal_factor: 1.0,
                bristle_stiffness_lateral_factor: 1.0,
                bristle_damping_longitudinal_factor: 1.0,
                bristle_damping_lateral_factor: 1.0,
                slip_longitudinal_factor: 0.8,
                slip_lateral_factor: 0.8
            }
        };

        // Suspension Preview System
        class SuspensionPreview {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.width = this.canvas.width = this.canvas.offsetWidth;
                this.height = this.canvas.height = this.canvas.offsetHeight;
                
                // Bus properties
                this.bus = {
                    x: this.width / 2,
                    y: this.height / 2,
                    width: 200,
                    height: 80,
                    bodyY: this.height / 2,
                    frontSuspension: { length: 60, compression: 0, velocity: 0 },
                    rearSuspension: { length: 60, compression: 0, velocity: 0 },
                    roll: 0
                };
                
                // Physics properties
                this.springConstant = 0.1;
                this.dampingFactor = 0.08;
                this.mass = 10000;
                this.gravity = 0.5;
                
                // Animation state
                this.isAnimating = false;
                this.autoBumpActive = false;
                this.bumpPosition = 0.5;
                this.bumpHeight = 0;
                this.lastTime = 0;
                
                // Stats
                this.stats = {
                    frontTravel: 0,
                    rearTravel: 0,
                    bodyRoll: 0
                };
                
                this.resize();
                window.addEventListener('resize', () => this.resize());
            }
            
            resize() {
                this.width = this.canvas.width = this.canvas.offsetWidth;
                this.height = this.canvas.height = this.canvas.offsetHeight;
                this.bus.bodyY = this.height / 2;
                this.draw();
            }
            
            updateSuspensionParameters() {
                // Get current parameter values
                const frontDamping = parseFloat(document.getElementById('damping_scaling_front_factor').value) || 0.25;
                const rearDamping = parseFloat(document.getElementById('damping_scaling_rear_factor').value) || 1.25;
                const swayBar = parseFloat(document.getElementById('sway_bar_stiffness_factor').value) || 3.0;
                
                // Update physics based on parameters
                this.springConstant = 0.05 + (swayBar * 0.02);
                this.dampingFactor = 0.05 + (Math.max(frontDamping, rearDamping) * 0.03);
            }
            
            applyBump(intensity = 1.0) {
                this.bumpHeight = 30 * intensity;
                this.bus.frontSuspension.velocity -= 8 * intensity;
                this.bus.rearSuspension.velocity -= 6 * intensity;
            }
            
            update(deltaTime) {
                if (!this.isAnimating) return;
                
                this.updateSuspensionParameters();
                
                const dt = Math.min(deltaTime, 100) / 1000; // Convert to seconds, cap at 100ms
                
                // Calculate forces
                const frontSpringForce = -this.springConstant * this.bus.frontSuspension.compression;
                const frontDampingForce = -this.dampingFactor * this.bus.frontSuspension.velocity;
                const frontForce = frontSpringForce + frontDampingForce;
                
                const rearSpringForce = -this.springConstant * this.bus.rearSuspension.compression;
                const rearDampingForce = -this.dampingFactor * this.bus.rearSuspension.velocity;
                const rearForce = rearSpringForce + rearDampingForce;
                
                // Update velocities (F = ma -> a = F/m)
                this.bus.frontSuspension.velocity += (frontForce / this.mass) * dt;
                this.bus.rearSuspension.velocity += (rearForce / this.mass) * dt;
                
                // Update positions
                this.bus.frontSuspension.compression += this.bus.frontSuspension.velocity * dt;
                this.bus.rearSuspension.compression += this.bus.rearSuspension.velocity * dt;
                
                // Apply gravity and ground collision
                const groundLevel = this.height - 40;
                const frontWheelY = this.bus.bodyY + this.bus.frontSuspension.compression;
                const rearWheelY = this.bus.bodyY + this.bus.rearSuspension.compression;
                
                if (frontWheelY > groundLevel - this.bumpHeight * Math.abs(this.bumpPosition - 0.3)) {
                    this.bus.frontSuspension.compression = groundLevel - this.bus.bodyY - this.bumpHeight * Math.abs(this.bumpPosition - 0.3);
                    this.bus.frontSuspension.velocity *= -0.3; // Bounce with energy loss
                }
                
                if (rearWheelY > groundLevel - this.bumpHeight * Math.abs(this.bumpPosition - 0.7)) {
                    this.bus.rearSuspension.compression = groundLevel - this.bus.bodyY - this.bumpHeight * Math.abs(this.bumpPosition - 0.7);
                    this.bus.rearSuspension.velocity *= -0.3; // Bounce with energy loss
                }
                
                // Calculate body roll based on suspension difference
                this.bus.roll = (this.bus.frontSuspension.compression - this.bus.rearSuspension.compression) * 0.5;
                
                // Update stats
                this.stats.frontTravel = Math.abs(this.bus.frontSuspension.compression).toFixed(1);
                this.stats.rearTravel = Math.abs(this.bus.rearSuspension.compression).toFixed(1);
                this.stats.bodyRoll = Math.abs(this.bus.roll).toFixed(1);
                
                this.updateStatsDisplay();
                
                // Gradually reduce bump height
                this.bumpHeight *= 0.95;
                if (this.bumpHeight < 0.1) this.bumpHeight = 0;
                
                // Auto-bump logic
                if (this.autoBumpActive && Math.random() < 0.02) {
                    this.applyBump(0.5 + Math.random() * 0.5);
                }
                
                this.draw();
            }
            
            updateStatsDisplay() {
                document.getElementById('frontTravel').textContent = this.stats.frontTravel;
                document.getElementById('rearTravel').textContent = this.stats.rearTravel;
                document.getElementById('bodyRoll').textContent = this.stats.bodyRoll;
            }
            
            draw() {
                const ctx = this.ctx;
                const bus = this.bus;
                
                // Clear canvas
                ctx.clearRect(0, 0, this.width, this.height);
                
                // Draw sky gradient
                const skyGradient = ctx.createLinearGradient(0, 0, 0, this.height);
                skyGradient.addColorStop(0, '#87CEEB');
                skyGradient.addColorStop(1, '#98FB98');
                ctx.fillStyle = skyGradient;
                ctx.fillRect(0, 0, this.width, this.height);
                
                // Draw road
                ctx.fillStyle = '#654321';
                ctx.fillRect(0, this.height - 40, this.width, 40);
                
                // Draw road markings
                ctx.strokeStyle = '#FFFFFF';
                ctx.lineWidth = 2;
                ctx.setLineDash([20, 15]);
                ctx.beginPath();
                ctx.moveTo(0, this.height - 20);
                ctx.lineTo(this.width, this.height - 20);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Draw bump if active
                if (this.bumpHeight > 0) {
                    const bumpX = this.width * this.bumpPosition;
                    const bumpWidth = 60;
                    const bumpHeight = this.bumpHeight;
                    
                    ctx.fillStyle = '#FF6B6B';
                    ctx.beginPath();
                    ctx.moveTo(bumpX - bumpWidth/2, this.height - 40);
                    ctx.quadraticCurveTo(bumpX, this.height - 40 - bumpHeight, bumpX + bumpWidth/2, this.height - 40);
                    ctx.fill();
                    
                    // Update bump indicator position
                    document.getElementById('bumpIndicator').style.left = `${bumpX}px`;
                }
                
                // Calculate wheel positions with suspension
                const frontWheelX = bus.x - bus.width * 0.35;
                const rearWheelX = bus.x + bus.width * 0.35;
                const frontWheelY = bus.bodyY + bus.frontSuspension.compression;
                const rearWheelY = bus.bodyY + bus.rearSuspension.compression;
                
                // Draw suspension springs
                this.drawSpring(ctx, frontWheelX, bus.bodyY, frontWheelX, frontWheelY, 15, bus.frontSuspension.compression);
                this.drawSpring(ctx, rearWheelX, bus.bodyY, rearWheelX, rearWheelY, 15, bus.rearSuspension.compression);
                
                // Draw wheels
                ctx.fillStyle = '#2C3E50';
                ctx.beginPath();
                ctx.arc(frontWheelX, frontWheelY, 20, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(rearWheelX, rearWheelY, 20, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw wheel details
                ctx.strokeStyle = '#34495E';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(frontWheelX, frontWheelY, 15, 0, Math.PI * 2);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.arc(rearWheelX, rearWheelY, 15, 0, Math.PI * 2);
                ctx.stroke();
                
                // Draw bus body with roll
                ctx.save();
                ctx.translate(bus.x, bus.bodyY);
                ctx.rotate(bus.roll * 0.01);
                
                // Bus body
                ctx.fillStyle = '#3498DB';
                ctx.fillRect(-bus.width/2, -bus.height/2, bus.width, bus.height);
                
                // Windows
                ctx.fillStyle = '#1ABC9C';
                ctx.fillRect(-bus.width/2 + 10, -bus.height/2 + 10, bus.width - 20, 25);
                
                // Headlights
                ctx.fillStyle = '#F1C40F';
                ctx.fillRect(-bus.width/2 + 5, -bus.height/2 + 5, 10, 8);
                ctx.fillRect(-bus.width/2 + 5, bus.height/2 - 13, 10, 8);
                
                ctx.restore();
                
                // Draw suspension travel indicators
                this.drawTravelIndicator(ctx, frontWheelX - 30, frontWheelY, bus.frontSuspension.compression);
                this.drawTravelIndicator(ctx, rearWheelX + 30, rearWheelY, bus.rearSuspension.compression);
            }
            
            drawSpring(ctx, x1, y1, x2, y2, coils, compression) {
                ctx.strokeStyle = '#E74C3C';
                ctx.lineWidth = 3;
                ctx.lineCap = 'round';
                
                const length = Math.abs(y2 - y1);
                const coilHeight = length / coils;
                
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                
                for (let i = 0; i < coils; i++) {
                    const yStart = y1 + i * coilHeight;
                    const yEnd = y1 + (i + 1) * coilHeight;
                    
                    ctx.bezierCurveTo(
                        x1 - 10, yStart + coilHeight * 0.3,
                        x1 - 10, yEnd - coilHeight * 0.3,
                        x1, yEnd
                    );
                }
                
                ctx.stroke();
            }
            
            drawTravelIndicator(ctx, x, y, compression) {
                const maxTravel = 30;
                const travel = Math.min(Math.abs(compression) / 2, maxTravel);
                const percentage = travel / maxTravel;
                
                // Color based on compression (green -> yellow -> red)
                let color;
                if (percentage < 0.5) {
                    color = '#2ECC71'; // Green
                } else if (percentage < 0.8) {
                    color = '#F39C12'; // Yellow
                } else {
                    color = '#E74C3C'; // Red
                }
                
                ctx.fillStyle = color;
                ctx.fillRect(x - 5, y - travel, 10, travel);
                
                // Background
                ctx.strokeStyle = '#7F8C8D';
                ctx.lineWidth = 2;
                ctx.strokeRect(x - 5, y - maxTravel, 10, maxTravel);
            }
            
            startAnimation() {
                if (!this.isAnimating) {
                    this.isAnimating = true;
                    this.lastTime = performance.now();
                    this.animate();
                }
            }
            
            stopAnimation() {
                this.isAnimating = false;
            }
            
            animate() {
                if (!this.isAnimating) return;
                
                const currentTime = performance.now();
                const deltaTime = currentTime - this.lastTime;
                this.lastTime = currentTime;
                
                this.update(deltaTime);
                
                requestAnimationFrame(() => this.animate());
            }
            
            reset() {
                this.bus.frontSuspension.compression = 0;
                this.bus.frontSuspension.velocity = 0;
                this.bus.rearSuspension.compression = 0;
                this.bus.rearSuspension.velocity = 0;
                this.bus.roll = 0;
                this.bumpHeight = 0;
                this.stats.frontTravel = '0.0';
                this.stats.rearTravel = '0.0';
                this.stats.bodyRoll = '0.0';
                this.updateStatsDisplay();
                this.draw();
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeUI();
            setupEventListeners();
            resetToDefault();
            
            // Initialize suspension preview
            window.suspensionPreview = new SuspensionPreview('suspensionPreview');
            suspensionPreview.draw(); // Initial draw
        });

        function initializeUI() {
            // Set default preset as active
            document.querySelector(`[data-preset="${state.currentPreset}"]`).classList.add('active');
            
            // Initialize all parameter displays
            updateAllParameterDisplays();
            
            // Update SII preview
            updateSIIPreview();
        }

        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });

            // Preset buttons - FIXED: Proper event delegation
            document.querySelectorAll('.preset-card').forEach(card => {
                card.addEventListener('click', function() {
                    const preset = this.getAttribute('data-preset');
                    console.log('Preset clicked:', preset); // Debug log
                    
                    // Update active state first
                    document.querySelectorAll('.preset-card').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    
                    if (preset !== 'custom') {
                        applyPreset(preset);
                    }
                });
            });

            // File operations
            document.getElementById('importBtn').addEventListener('click', function() {
                document.getElementById('fileInput').click();
            });

            document.getElementById('fileInput').addEventListener('change', function() {
                if (this.files.length > 0) {
                    loadSIIFile(this.files[0]);
                }
            });

            document.getElementById('exportBtn').addEventListener('click', exportSIIFile);
            document.getElementById('undoBtn').addEventListener('click', undo);
            document.getElementById('redoBtn').addEventListener('click', redo);
            document.getElementById('resetBtn').addEventListener('click', resetToDefault);
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            document.getElementById('helpBtn').addEventListener('click', showHelp);
            document.getElementById('refreshPreview').addEventListener('click', updateSIIPreview);

            // Suspension preview controls - FIXED: Proper event listeners
            document.getElementById('testSuspension').addEventListener('click', function() {
                console.log('Test Suspension clicked'); // Debug log
                if (window.suspensionPreview) {
                    suspensionPreview.startAnimation();
                    suspensionPreview.applyBump(1.0);
                }
            });

            document.getElementById('autoBump').addEventListener('click', function() {
                console.log('Auto-bump clicked'); // Debug log
                if (window.suspensionPreview) {
                    suspensionPreview.autoBumpActive = !suspensionPreview.autoBumpActive;
                    suspensionPreview.startAnimation();
                    this.innerHTML = suspensionPreview.autoBumpActive ? 
                        '<i class="fas fa-pause"></i> Stop Auto-bump' : 
                        '<i class="fas fa-sync"></i> Auto-bump';
                }
            });

            document.getElementById('resetPreview').addEventListener('click', function() {
                console.log('Reset Preview clicked'); // Debug log
                if (window.suspensionPreview) {
                    suspensionPreview.reset();
                }
            });

            // Parameter input synchronization - all parameters
            const parameters = Object.keys(presets.default);
            
            parameters.forEach(param => {
                const slider = document.getElementById(param);
                const number = document.getElementById(`${param}_num`);
                
                if (slider && number) {
                    slider.addEventListener('input', function() {
                        number.value = this.value;
                        updateParameterDisplay(param, this.value);
                        onParameterChange(param, this.value);
                        
                        // Update suspension preview if suspension parameters change
                        if (param.includes('damping') || param.includes('sway')) {
                            if (window.suspensionPreview) {
                                suspensionPreview.updateSuspensionParameters();
                            }
                        }
                    });
                    
                    number.addEventListener('input', function() {
                        slider.value = this.value;
                        updateParameterDisplay(param, this.value);
                        onParameterChange(param, this.value);
                        
                        // Update suspension preview if suspension parameters change
                        if (param.includes('damping') || param.includes('sway')) {
                            if (window.suspensionPreview) {
                                suspensionPreview.updateSuspensionParameters();
                            }
                        }
                    });
                }
            });
        }

        function switchTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabId}-tab`).classList.add('active');
            
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            
            // Start suspension preview animation when suspension tab is selected
            if (tabId === 'suspension' && window.suspensionPreview) {
                suspensionPreview.startAnimation();
            }
        }

        function applyPreset(presetName) {
            console.log('Applying preset:', presetName); // Debug log
            if (presets[presetName]) {
                state.currentPreset = presetName;
                
                // Save current state to history
                saveToHistory();
                
                // Apply preset values
                const preset = presets[presetName];
                for (const param in preset) {
                    const slider = document.getElementById(param);
                    const number = document.getElementById(`${param}_num`);
                    
                    if (slider && number) {
                        slider.value = preset[param];
                        number.value = preset[param];
                        updateParameterDisplay(param, preset[param]);
                        state.currentValues[param] = preset[param];
                    }
                }
                
                // Update modified status
                state.isModified = true;
                updateModifiedStatus();
                
                // Update suspension preview
                if (window.suspensionPreview) {
                    suspensionPreview.updateSuspensionParameters();
                }
                
                // Update SII preview
                updateSIIPreview();
                
                console.log('Preset applied successfully'); // Debug log
            } else {
                console.log('Preset not found:', presetName); // Debug log
            }
        }

        function onParameterChange(param, value) {
            // Mark as modified
            state.isModified = true;
            updateModifiedStatus();
            
            // Update current values
            state.currentValues[param] = parseFloat(value);
            
            // Change preset to custom if not already
            if (state.currentPreset !== 'custom') {
                state.currentPreset = 'custom';
                document.querySelectorAll('.preset-card').forEach(card => card.classList.remove('active'));
                document.querySelector('[data-preset="custom"]').classList.add('active');
            }
            
            // Update SII preview
            updateSIIPreview();
        }

        function updateParameterDisplay(param, value) {
            const displayElement = document.getElementById(`${param}_val`);
            if (displayElement) {
                displayElement.textContent = value;
                
                // Highlight if different from default
                const defaultValue = presets.default[param];
                if (parseFloat(value) !== defaultValue) {
                    displayElement.classList.add('highlight');
                } else {
                    displayElement.classList.remove('highlight');
                }
            }
        }

        function updateAllParameterDisplays() {
            for (const param in presets.default) {
                const value = state.currentValues[param] || presets.default[param];
                updateParameterDisplay(param, value);
            }
        }

        function updateModifiedStatus() {
            const modifiedStatus = document.getElementById('modifiedStatus');
            if (state.isModified) {
                modifiedStatus.style.display = 'flex';
            } else {
                modifiedStatus.style.display = 'none';
            }
        }

        function loadSIIFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    parseSIIFile(content);
                    document.getElementById('statusText').textContent = `Loaded: ${file.name}`;
                    state.isModified = false;
                    updateModifiedStatus();
                } catch (error) {
                    alert('Error parsing SII file: ' + error.message);
                }
            };
            
            reader.readAsText(file);
        }

        function parseSIIFile(content) {
            // Save current state to history
            saveToHistory();
            
            // Reset to default first
            resetToDefault(false);
            
            // Simple parsing for SII format
            const lines = content.split('\n');
            const values = {};
            
            lines.forEach(line => {
                // Match lines like: steering_speed_coef: 1.0
                const match = line.match(/(\w+):\s*([\d.-]+)/);
                if (match) {
                    const param = match[1];
                    const value = parseFloat(match[2]);
                    values[param] = value;
                }
            });
            
            // Apply parsed values to UI
            for (const param in values) {
                const slider = document.getElementById(param);
                const number = document.getElementById(`${param}_num`);
                
                if (slider && number) {
                    slider.value = values[param];
                    number.value = values[param];
                    updateParameterDisplay(param, values[param]);
                    state.currentValues[param] = values[param];
                }
            }
            
            // Update status
            state.currentPreset = 'custom';
            document.querySelectorAll('.preset-card').forEach(card => card.classList.remove('active'));
            document.querySelector('[data-preset="custom"]').classList.add('active');
            
            // Update suspension preview
            if (window.suspensionPreview) {
                suspensionPreview.updateSuspensionParameters();
            }
            
            // Update SII preview
            updateSIIPreview();
        }

        function exportSIIFile() {
            // Generate SII file content
            let content = generateSIIFile();
            
            // Create download link
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'bus_physics.sii';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Update status
            document.getElementById('statusText').textContent = 'File exported successfully';
            state.isModified = false;
            updateModifiedStatus();
        }

        function generateSIIFile() {
            // Generate complete SII file with proper structure
            let content = "SiiNunit\n";
            content += "{\n";
            content += "physics_data: .phdata\n";
            content += "{\n";
            content += "\n\n";
            content += "\tversion: " + (state.currentValues.version || 2) + "\n";
            content += "\n\n";
            
            // Add all parameters with proper formatting
            const parameters = Object.keys(presets.default);
            parameters.forEach(param => {
                if (param !== 'version') {
                    const value = state.currentValues[param] || presets.default[param];
                    content += `\t${param}:\t${value}\n`;
                }
            });
            
            content += "\n";
            content += "}\n";
            content += "}\n";
            
            return content;
        }

        function updateSIIPreview() {
            const previewElement = document.getElementById('siiPreview');
            if (previewElement) {
                previewElement.textContent = generateSIIFile();
            }
        }

        function resetToDefault(saveHistory = true) {
            if (saveHistory) {
                saveToHistory();
            }
            
            applyPreset('default');
            state.isModified = false;
            updateModifiedStatus();
            document.getElementById('statusText').textContent = 'Reset to default values';
        }

        function saveToHistory() {
            // Only save if values have changed
            const currentState = JSON.parse(JSON.stringify(state.currentValues));
            
            // If we're not at the end of history, remove future states
            if (state.historyIndex < state.history.length - 1) {
                state.history = state.history.slice(0, state.historyIndex + 1);
            }
            
            state.history.push(currentState);
            state.historyIndex = state.history.length - 1;
            
            // Limit history size
            if (state.history.length > 50) {
                state.history.shift();
                state.historyIndex--;
            }
        }

        function undo() {
            if (state.historyIndex > 0) {
                state.historyIndex--;
                const previousState = state.history[state.historyIndex];
                
                // Apply previous state
                for (const param in previousState) {
                    const slider = document.getElementById(param);
                    const number = document.getElementById(`${param}_num`);
                    
                    if (slider && number) {
                        slider.value = previousState[param];
                        number.value = previousState[param];
                        updateParameterDisplay(param, previousState[param]);
                        state.currentValues[param] = previousState[param];
                    }
                }
                
                state.isModified = true;
                updateModifiedStatus();
                state.currentPreset = 'custom';
                document.querySelectorAll('.preset-card').forEach(card => card.classList.remove('active'));
                document.querySelector('[data-preset="custom"]').classList.add('active');
                
                // Update suspension preview
                if (window.suspensionPreview) {
                    suspensionPreview.updateSuspensionParameters();
                }
                
                // Update SII preview
                updateSIIPreview();
            }
        }

        function redo() {
            if (state.historyIndex < state.history.length - 1) {
                state.historyIndex++;
                const nextState = state.history[state.historyIndex];
                
                // Apply next state
                for (const param in nextState) {
                    const slider = document.getElementById(param);
                    const number = document.getElementById(`${param}_num`);
                    
                    if (slider && number) {
                        slider.value = nextState[param];
                        number.value = nextState[param];
                        updateParameterDisplay(param, nextState[param]);
                        state.currentValues[param] = nextState[param];
                    }
                }
                
                state.isModified = true;
                updateModifiedStatus();
                state.currentPreset = 'custom';
                document.querySelectorAll('.preset-card').forEach(card => card.classList.remove('active'));
                document.querySelector('[data-preset="custom"]').classList.add('active');
                
                // Update suspension preview
                if (window.suspensionPreview) {
                    suspensionPreview.updateSuspensionParameters();
                }
                
                // Update SII preview
                updateSIIPreview();
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const themeToggle = document.getElementById('themeToggle');
            if (document.body.classList.contains('dark-mode')) {
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }

        function showHelp() {
            alert("SCS Bus Physics Editor Help:\n\n1. Select a preset or import a .sii file to get started\n2. Adjust parameters using sliders or number inputs\n3. Modified values are highlighted in blue\n4. Check the SII Preview to see the generated file\n5. Export your changes when finished\n6. Use Undo/Redo to revert changes\n\nSUSPENSION PREVIEW:\n- Use 'Test Suspension' to apply a bump\n- Enable 'Auto-bump' for continuous testing\n- Watch the travel indicators (green=good, red=limit)\n- Adjust damping and stiffness to see real-time effects");
        }
    </script>
</body>
</html>